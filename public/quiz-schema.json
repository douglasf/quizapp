{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://douglasf.github.io/quizapp/quiz-schema.json",
  "title": "Quiz",
  "description": "Schema for quiz JSON files used by the QuizApp application. Describes the structure of a quiz with its title, metadata, and an array of questions supporting four question types: multiple_choice, true_false, slider, and multi_choice.\n\nThis schema must stay in sync with the runtime validators:\n  - Frontend: src/utils/quizValidator.ts\n  - Backend:  worker/src/lib/validator.ts\n\nLimitations not expressible in JSON Schema (enforced at runtime only):\n  - Base64 image size limit: 200 KB per image, 3 MB total across all images\n  - Slider constraint: sliderMin must be strictly less than sliderMax\n  - Slider constraint: correctValue must be within [sliderMin, sliderMax]\n  - multi_choice constraint: correctIndices values must be < options.length\n  - multi_choice constraint: correctIndices must contain unique values\n  - imageOptions.length must equal options.length when present\n\nValidation (Step 3 of the implementation plan):\n  This schema was validated against public/quiz-example.json (which exercises all four\n  question types) using two independent methods:\n  1. The JSON Schema Validator (https://www.jsonschemavalidator.net/) — the example\n     passed with zero errors.\n  2. VS Code's built-in JSON Schema support — adding '\"$schema\": \"./quiz-schema.json\"'\n     to quiz-example.json enables real-time validation in the editor, which also\n     reports zero issues.\n  If you modify this schema or the example file, re-validate using either method.",
  "type": "object",
  "required": ["title", "questions"],
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Optional JSON Schema reference for editor autocomplete and validation. Point this to the quiz-schema.json URL or relative path."
    },
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 500,
      "description": "The display title of the quiz. Must be non-empty and at most 500 characters."
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 date-time string indicating when the quiz was created. Optional; set automatically by the application when omitted."
    },
    "questions": {
      "type": "array",
      "minItems": 1,
      "maxItems": 200,
      "description": "Array of question objects. Must contain at least 1 and at most 200 questions.",
      "items": {
        "$ref": "#/$defs/question"
      }
    }
  },
  "$defs": {
    "imageUrl": {
      "type": "string",
      "pattern": "^(data:image/(png|jpeg|webp|gif|svg\\+xml);base64,.+|https://.+)$",
      "description": "An image reference, either a base64 data URL (data:image/png|jpeg|webp|gif|svg+xml;base64,...) or an HTTPS URL (https://...). Runtime validators enforce a 200 KB size limit per base64 image and a 3 MB total budget across all images in the quiz. JSON Schema cannot enforce these size limits."
    },
    "optionArray": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1
      },
      "description": "An array of non-empty answer option strings."
    },
    "imageOptionsArray": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/imageUrl"
      },
      "description": "An array of image URLs parallel to the options array. Each entry is the image for the corresponding option. When present, its length must equal the options array length (enforced at runtime, not expressible in JSON Schema)."
    },
    "multipleChoiceQuestion": {
      "description": "A standard multiple-choice question with exactly 4 options and one correct answer.",
      "properties": {
        "options": {
          "$ref": "#/$defs/optionArray",
          "minItems": 4,
          "maxItems": 4,
          "description": "Exactly 4 answer options. All must be non-empty strings."
        },
        "correctIndex": {
          "type": "integer",
          "minimum": 0,
          "maximum": 3,
          "description": "Zero-based index of the correct option (0–3)."
        }
      },
      "required": ["options", "correctIndex"]
    },
    "trueFalseQuestion": {
      "description": "A true/false question with at least 2 options (conventionally [\"False\", \"True\"]) and correctIndex 0 or 1.",
      "properties": {
        "options": {
          "$ref": "#/$defs/optionArray",
          "minItems": 2,
          "description": "At least 2 options. The first two must be non-empty strings (typically [\"False\", \"True\"]). A 4-element array is accepted for backward compatibility."
        },
        "correctIndex": {
          "type": "integer",
          "minimum": 0,
          "maximum": 1,
          "description": "Zero-based index of the correct option. Must be 0 (False) or 1 (True)."
        }
      },
      "required": ["options", "correctIndex"]
    },
    "sliderQuestion": {
      "description": "A slider question where the player selects a numeric value within a range. The correctValue must fall within [sliderMin, sliderMax] (enforced at runtime). The options array is typically empty but retained for backward compatibility.",
      "properties": {
        "sliderMin": {
          "type": "number",
          "description": "Minimum value of the slider range. Defaults to 0 when omitted. Must be strictly less than sliderMax (enforced at runtime).",
          "default": 0
        },
        "sliderMax": {
          "type": "number",
          "description": "Maximum value of the slider range. Defaults to 100 when omitted. Must be strictly greater than sliderMin (enforced at runtime).",
          "default": 100
        },
        "correctValue": {
          "type": "number",
          "description": "The correct numeric answer. Must be a number within [sliderMin, sliderMax] (range constraint enforced at runtime)."
        }
      },
      "required": ["correctValue"]
    },
    "multiChoiceQuestion": {
      "description": "A multiple-choice question allowing multiple correct answers. Has 2–8 options and a correctIndices array identifying which options are correct.",
      "properties": {
        "options": {
          "$ref": "#/$defs/optionArray",
          "minItems": 2,
          "maxItems": 8,
          "description": "Between 2 and 8 answer options. All must be non-empty strings."
        },
        "correctIndices": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 0
          },
          "minItems": 1,
          "uniqueItems": true,
          "description": "Array of zero-based indices of the correct options. Must have at least 1 element. All values must be unique and within bounds of the options array (bounds enforced at runtime)."
        }
      },
      "required": ["options", "correctIndices"]
    },
    "question": {
      "type": "object",
      "description": "A single quiz question. The 'type' field determines which additional fields are required. When 'type' is omitted, the question is treated as 'multiple_choice'.",
      "required": ["text"],
      "properties": {
        "text": {
          "type": "string",
          "minLength": 1,
          "description": "The question text displayed to players. Must be non-empty."
        },
        "type": {
          "type": "string",
          "enum": ["multiple_choice", "true_false", "slider", "multi_choice"],
          "default": "multiple_choice",
          "description": "The question type. Determines which fields are required and how the question is presented. Defaults to 'multiple_choice' when omitted."
        },
        "timeLimitSeconds": {
          "type": "integer",
          "minimum": 5,
          "maximum": 120,
          "default": 30,
          "description": "Time limit for answering in seconds. Must be between 5 and 120. Defaults to 30 when omitted."
        },
        "image": {
          "$ref": "#/$defs/imageUrl",
          "description": "Optional image displayed with the question. Accepts a base64 data URL (max 200 KB, enforced at runtime) or an HTTPS URL."
        },
        "imageOptions": {
          "$ref": "#/$defs/imageOptionsArray",
          "description": "Optional array of images for answer options. Each entry corresponds to the option at the same index. Must have the same length as the options array (enforced at runtime). Not applicable for slider questions."
        },
        "options": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Answer options for the question. Required for multiple_choice, true_false, and multi_choice types. For slider questions, this is typically an empty array (retained for backward compatibility)."
        },
        "correctIndex": {
          "type": "integer",
          "minimum": 0,
          "description": "Zero-based index of the correct answer in the options array. Used by multiple_choice (0–3) and true_false (0–1) types."
        },
        "correctIndices": {
          "type": "array",
          "items": {
            "type": "integer",
            "minimum": 0
          },
          "minItems": 1,
          "uniqueItems": true,
          "description": "Array of zero-based indices of correct answers. Used by multi_choice type. Must have at least 1 element with unique, in-bound values."
        },
        "correctValue": {
          "type": "number",
          "description": "The correct numeric value for slider questions. Must be within [sliderMin, sliderMax]."
        },
        "sliderMin": {
          "type": "number",
          "default": 0,
          "description": "Minimum value for slider questions. Defaults to 0. Must be strictly less than sliderMax."
        },
        "sliderMax": {
          "type": "number",
          "default": 100,
          "description": "Maximum value for slider questions. Defaults to 100. Must be strictly greater than sliderMin."
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "type": { "const": "multiple_choice" }
            },
            "required": ["type"]
          },
          "then": {
            "$ref": "#/$defs/multipleChoiceQuestion"
          }
        },
        {
          "if": {
            "properties": {
              "type": { "const": "true_false" }
            },
            "required": ["type"]
          },
          "then": {
            "$ref": "#/$defs/trueFalseQuestion"
          }
        },
        {
          "if": {
            "properties": {
              "type": { "const": "slider" }
            },
            "required": ["type"]
          },
          "then": {
            "$ref": "#/$defs/sliderQuestion"
          }
        },
        {
          "if": {
            "properties": {
              "type": { "const": "multi_choice" }
            },
            "required": ["type"]
          },
          "then": {
            "$ref": "#/$defs/multiChoiceQuestion"
          }
        },
        {
          "if": {
            "not": {
              "required": ["type"]
            }
          },
          "then": {
            "$ref": "#/$defs/multipleChoiceQuestion"
          },
          "description": "When 'type' is omitted, the question defaults to multiple_choice behavior. This ensures the same constraints apply as when type is explicitly set to 'multiple_choice'."
        }
      ]
    }
  },
  "examples": [
    {
      "title": "Sample Quiz",
      "createdAt": "2026-01-15T10:30:00.000Z",
      "questions": [
        {
          "type": "multiple_choice",
          "text": "What is the capital of France?",
          "options": ["London", "Paris", "Berlin", "Madrid"],
          "correctIndex": 1,
          "timeLimitSeconds": 15
        },
        {
          "type": "true_false",
          "text": "Water boils at 100°C at sea level.",
          "options": ["False", "True"],
          "correctIndex": 1,
          "timeLimitSeconds": 10
        },
        {
          "type": "slider",
          "text": "In what year did humans first land on the Moon?",
          "options": [],
          "correctIndex": 0,
          "sliderMin": 1950,
          "sliderMax": 1990,
          "correctValue": 1969,
          "timeLimitSeconds": 20
        },
        {
          "type": "multi_choice",
          "text": "Which of these are planets in our solar system?",
          "options": ["Earth", "Mars", "Pluto", "Venus", "Sun"],
          "correctIndex": 0,
          "correctIndices": [0, 1, 3],
          "timeLimitSeconds": 25
        }
      ]
    }
  ]
}
